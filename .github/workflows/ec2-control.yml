name: Control EC2

on:
  schedule:
    # 每天台灣 06:40 開機（= UTC 22:40）
    - cron: '40 22 * * *'
    # 每天台灣 07:30 開機（= UTC 23:30）
    - cron: '30 23 * * *'
    # 每天台灣 08:00 關機（= UTC 00:00）
    - cron: '0 0 * * *'
    # 每天台灣 08:40 關機（= UTC 00:40）
    - cron: '40 0 * * *'
  workflow_dispatch:

jobs:
  ec2-control:
    runs-on: ubuntu-latest
    steps:
      - name: Start/Stop EC2
        env:
          AWS_ACCESS_KEY_ID: ${{ secrets.AWS_ACCESS_KEY_ID }}
          AWS_SECRET_ACCESS_KEY: ${{ secrets.AWS_SECRET_ACCESS_KEY }}
          AWS_SESSION_TOKEN : ${{ secrets.AWS_SESSION_TOKEN }}
          AWS_DEFAULT_REGION: ap-northeast-1 # 改成你的區域
        run: |
          INSTANCE_ID="i-0b9fe2660a50a202f"  # 換成你的 EC2 ID
          HOUR=$(date -u +%H)

          if [ "$HOUR" -eq 0 ]; then
            echo "🟢 Starting EC2..."
            aws ec2 start-instances --instance-ids $INSTANCE_ID
          else
            echo "🔴 Stopping EC2..."
            aws ec2 stop-instances --instance-ids $INSTANCE_ID
          fi

