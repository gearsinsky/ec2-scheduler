name: Control EC2

on:
  schedule:
    # æ¯å¤©å°ç£ 06:40 é–‹æ©Ÿï¼ˆ= UTC 22:40ï¼‰
    - cron: '40 22 * * *'
    # æ¯å¤©å°ç£ 07:30 é–‹æ©Ÿï¼ˆ= UTC 23:30ï¼‰
    - cron: '30 23 * * *'
    # æ¯å¤©å°ç£ 08:00 é—œæ©Ÿï¼ˆ= UTC 00:00ï¼‰
    - cron: '0 0 * * *'
    # æ¯å¤©å°ç£ 08:40 é—œæ©Ÿï¼ˆ= UTC 00:40ï¼‰
    - cron: '40 0 * * *'
  workflow_dispatch:

jobs:
  ec2-control:
    runs-on: ubuntu-latest
    steps:
      - name: Start/Stop EC2
        env:
          AWS_ACCESS_KEY_ID: ${{ secrets.AWS_ACCESS_KEY_ID }}
          AWS_SECRET_ACCESS_KEY: ${{ secrets.AWS_SECRET_ACCESS_KEY }}
          AWS_SESSION_TOKEN : ${{ secrets.AWS_SESSION_TOKEN }}
          AWS_DEFAULT_REGION: ap-northeast-1 # æ”¹æˆä½ çš„å€åŸŸ
        run: |
          INSTANCE_ID="i-0b9fe2660a50a202f"  # æ›æˆä½ çš„ EC2 ID
          HOUR=$(date -u +%H)

          if [ "$HOUR" -eq 0 ]; then
            echo "ğŸŸ¢ Starting EC2..."
            aws ec2 start-instances --instance-ids $INSTANCE_ID
          else
            echo "ğŸ”´ Stopping EC2..."
            aws ec2 stop-instances --instance-ids $INSTANCE_ID
          fi

